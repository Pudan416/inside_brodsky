import random
import pickle
import os
from pathlib import Path
from games.base_game import BaseGame
from config.settings import settings


class RoomGame(BaseGame):
    """–ò–≥—Ä–∞ '–ù–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã' –ø–æ –º–æ—Ç–∏–≤–∞–º —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏—è –ë—Ä–æ–¥—Å–∫–æ–≥–æ"""

    name = "–ù–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã"
    poem = "–ù–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã"
    description = "–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –≥—Ä–∞–Ω–∏—Ü—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–∏—Ä–∞, –Ω–µ –≤—ã—Ö–æ–¥—è –∏–∑ –∫–æ–º–Ω–∞—Ç—ã"

    def __init__(self, user_id: int):
        super().__init__(user_id)
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–≥—Ä—ã
        self.exits = {
            "–æ–∫–Ω–æ": "–í–∏–¥ –Ω–∞ —É–ª–∏—Ü—É, –≥–¥–µ –∂–∏–∑–Ω—å –∫–∞–∂–µ—Ç—Å—è –æ–±–º–∞–Ω—á–∏–≤–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–π",
            "–¥–≤–µ—Ä—å": "–í—ã—Ö–æ–¥ –≤ –º–∏—Ä, –ø–æ–ª–Ω—ã–π –ª—é–¥–µ–π —Å –ª–∏—Ü–∞–º–∏, –∫–∞–∫ –∫—Ä—É–ø–∞",
            "—É–±–æ—Ä–Ω–∞—è": "–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ, –∫—É–¥–∞ –º–æ–∂–Ω–æ –≤—ã–π—Ç–∏, –Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è",
        }
        self.objects = {
            "—à–∏–ø–∫–∞": {"description": "–ü–∞—á–∫–∞ —Å–∏–≥–∞—Ä–µ—Ç '–®–∏–ø–∫–∞'", "uses": 20},
            "–º–µ–±–µ–ª—å": {
                "description": "–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è –º–µ–±–µ–ª—å, –Ω–µ –æ—Ç–ª–∏—á–∏–º–∞—è –æ—Ç –ª—é–¥–µ–π —Å–Ω–∞—Ä—É–∂–∏",
                "uses": None,
            },
            "–ø–∞–ª—å—Ç–æ": {
                "description": "–°—Ç–∞—Ä–æ–µ –ø–∞–ª—å—Ç–æ –Ω–∞ –≤–µ—à–∞–ª–∫–µ",
                "uses": None,
            },
            "–±—É–º–∞–≥–∞": {
                "description": "–õ–∏—Å—Ç –±—É–º–∞–≥–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –≤—Å–µ–ª–µ–Ω–Ω–æ–π",
                "uses": 100,
            },
        }
        self.time_passed = 0  # –í—Ä–µ–º—è, –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–µ –≤ –∫–æ–º–Ω–∞—Ç–µ (–≤ —á–∞—Å–∞—Ö)
        self.exit_attempts = 0  # –°—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –≤—ã–π—Ç–∏
        self.thoughts = []  # –ó–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –º—ã—Å–ª–∏
        self.win_time = 200  # –í—Ä–µ–º—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –ø–æ–±–µ–¥—ã (–≤ —á–∞—Å–∞—Ö)

    def save_game_state(self) -> str:
        """Create a compact string representation of game state"""
        # Format: room|time_passed|state|exit_attempts
        state_parts = [
            "room",
            str(self.time_passed),
            self.state,
            str(self.exit_attempts),
        ]

        # Add object states with a different delimiter
        obj_parts = []
        for obj_name, obj_data in self.objects.items():
            if obj_data["uses"] is not None:
                obj_parts.append(f"{obj_name}={obj_data['uses']}")

        # Add the object state as a single part
        state_parts.append(",".join(obj_parts))

        # Join the main state with a pipe delimiter
        main_state = "|".join(state_parts)

        # Add thoughts with a completely separate section
        if self.thoughts:
            # Join thoughts with a different delimiter
            thought_section = "¬ß".join(self.thoughts)
            return f"{main_state}#THOUGHTS#{thought_section}"
        else:
            return main_state

    @classmethod
    def load_from_state_string(cls, user_id: int, state_string: str) -> "RoomGame":
        """Recreate game state from compact string"""
        game = cls(user_id)

        if not state_string or not state_string.startswith("room"):
            return game

        # Split thoughts section from main state
        if "#THOUGHTS#" in state_string:
            main_state, thoughts_section = state_string.split("#THOUGHTS#", 1)
            # Parse thoughts
            game.thoughts = thoughts_section.split("¬ß")
        else:
            main_state = state_string

        # Split main state parts
        parts = main_state.split("|")

        if len(parts) >= 4:
            game.time_passed = int(parts[1])
            game.state = parts[2]
            game.exit_attempts = int(parts[3])

            # Parse object states
            if len(parts) > 4:
                obj_states = parts[4].split(",")
                for obj_state in obj_states:
                    if "=" in obj_state:
                        obj_name, uses_str = obj_state.split("=", 1)
                        if obj_name in game.objects:
                            game.objects[obj_name]["uses"] = int(uses_str)

        return game

    def write_thought(self, thought: str) -> str:
        """–ó–∞–ø–∏—Å–∞—Ç—å –º—ã—Å–ª—å"""
        print(f"Writing thought: '{thought}', current state: {self.state}")

        if "–±—É–º–∞–≥–∞" not in self.objects or self.objects["–±—É–º–∞–≥–∞"]["uses"] <= 0:
            self.state = "normal"
            return "–£ —Ç–µ–±—è –Ω–µ—Ç –±—É–º–∞–≥–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –º—ã—Å–ª–µ–π."

        # Store only the thought text
        self.thoughts.append(thought)

        print(f"Thoughts after adding: {self.thoughts}")

        self.objects["–±—É–º–∞–≥–∞"]["uses"] -= 1
        self.time_passed += 4  # –ó–∞–ø–∏—Å—å –º—ã—Å–ª–∏ –∑–∞–Ω–∏–º–∞–µ—Ç 4 —á–∞—Å–∞
        self.state = "normal"

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏
        if self.time_passed >= self.win_time:
            self.state = "game_over"
            return f'–¢—ã –∑–∞–ø–∏—Å–∞–ª: "{thought}"\n\n{self.get_special_ending()}'

        return f'–¢—ã –∑–∞–ø–∏—Å–∞–ª: "{thought}".\n–í —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è—Ö –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤—Ä–µ–º—è, –∏ —ç—Ç–æ —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç.'

    def process_command(self, command: str) -> str:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã –∏–≥—Ä–æ–∫–∞"""
        command = command.lower().strip()

        # –ï—Å–ª–∏ –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
        if self.state == "game_over":
            return "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. –í–≤–µ–¥–∏ /start –¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω–æ–≤–æ–π –∏–≥—Ä—ã."

        # –ï—Å–ª–∏ –≤ —Ä–µ–∂–∏–º–µ –∑–∞–ø–∏—Å–∏ –º—ã—Å–ª–∏
        if self.state == "writing":
            result = self.write_thought(command)
            return result

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
        if command == "–æ—Å–º–æ—Ç—Ä–µ—Ç—å—Å—è":
            return self.look_around()
        elif command == "—Ä–∞–∑–º—ã—à–ª—è—Ç—å":
            return self.reflect()
        elif command.startswith("–≤—ã–π—Ç–∏"):
            parts = command.split(" ", 1)
            exit_name = parts[1] if len(parts) > 1 else "–¥–≤–µ—Ä—å"
            return self.try_exit(exit_name)
        elif command.startswith("–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å"):
            parts = command.split(" ", 1)
            item_name = parts[1] if len(parts) > 1 else ""
            return self.use_object(item_name)
        elif command == "–º—ã—Å–ª–∏":
            return self.view_thoughts()
        elif command == "–ø–æ–º–æ—â—å":
            return self.get_help()
        else:
            return "–Ø –Ω–µ –ø–æ–Ω–∏–º–∞—é. –í–≤–µ–¥–∏ '–ø–æ–º–æ—â—å' –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥."

    def look_around(self) -> str:
        """–û—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–Ω–∞—Ç—É"""
        # –û—Å–º–æ—Ç—Ä –∫–æ–º–Ω–∞—Ç—ã –∑–∞–Ω–∏–º–∞–µ—Ç 1 —á–∞—Å
        self.time_passed += 1

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏
        if self.time_passed >= self.win_time:
            self.state = "game_over"
            return f"–¢—ã –æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—à—å –∫–æ–º–Ω–∞—Ç—É...\n\n{self.get_special_ending()}"

        description = "\n–¢—ã –Ω–∞—Ö–æ–¥–∏—à—å—Å—è –≤ –∫–æ–º–Ω–∞—Ç–µ. –¢–≤–æ—ë–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ. –¢–≤–æ–µ–π –≤—Å–µ–ª–µ–Ω–Ω–æ–π."
        description += "\n\n–í—ã—Ö–æ–¥—ã:"
        for exit_name, exit_desc in self.exits.items():
            description += f"\n- {exit_name}: {exit_desc}"

        description += "\n\n–ü—Ä–µ–¥–º–µ—Ç—ã:"
        for obj_name, obj_data in self.objects.items():
            details = (
                f" (–æ—Å—Ç–∞–ª–æ—Å—å {obj_data['uses']})"
                if obj_data["uses"] is not None
                else ""
            )
            description += f"\n- {obj_name}: {obj_data['description']}{details}"

        description += f"\n\n–í—Ä–µ–º—è –≤ –∫–æ–º–Ω–∞—Ç–µ: {self.time_passed} —á–∞—Å–æ–≤"
        description += (
            f"\n–î–æ –ø–æ–ª–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è: {self.win_time - self.time_passed} —á–∞—Å–æ–≤"
        )

        return description

    def try_exit(self, exit_name: str) -> str:
        """–ü–æ–ø—ã—Ç–∫–∞ –≤—ã–π—Ç–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã"""
        # –ü–æ–ø—ã—Ç–∫–∞ –≤—ã–π—Ç–∏ –∑–∞–Ω–∏–º–∞–µ—Ç 2 —á–∞—Å–∞
        self.time_passed += 2

        if exit_name not in self.exits:
            return "–¢–∞–∫–æ–≥–æ –≤—ã—Ö–æ–¥–∞ –Ω–µ—Ç. –•–æ—Ç—è, –≤–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –∏ –∫ –ª—É—á—à–µ–º—É."

        # –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π –¥–ª—è —É–±–æ—Ä–Ω–æ–π
        if exit_name == "—É–±–æ—Ä–Ω–∞—è":
            return "–¢–æ–ª—å–∫–æ –≤ —É–±–æ—Ä–Ω—É—é ‚Äî –∏ —Å—Ä–∞–∑—É –∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è."

        # –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π –¥–ª—è –æ–∫–Ω–∞
        if exit_name == "–æ–∫–Ω–æ":
            self.exit_attempts += 1
            if self.exit_attempts >= 3:
                self.state = "game_over"
                return "–¢—ã –≤—ã—à–µ–ª –∏–∑ –∫–æ–º–Ω–∞—Ç—ã —á–µ—Ä–µ–∑ –æ–∫–Ω–æ. –ü–æ–∑–¥—Ä–∞–≤–ª—è—é, —Ç—ã —Å–æ–≤–µ—Ä—à–∏–ª –æ—à–∏–±–∫—É.\n–ö–û–ù–ï–¶ –ò–ì–†–´.\n\n–í–≤–µ–¥–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É."
            return "–ù–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã! –ù–∞ —É–ª–∏—Ü–µ, —á–∞–π, –Ω–µ –§—Ä–∞–Ω—Ü–∏—è."

        # –î–ª—è –¥–≤–µ—Ä–∏ –∏ –¥—Ä—É–≥–∏—Ö –≤—ã—Ö–æ–¥–æ–≤
        self.exit_attempts += 1

        responses = [
            "–ù–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã, –Ω–µ —Å–æ–≤–µ—Ä—à–∞–π –æ—à–∏–±–∫—É.",
            "–ó–∞ –¥–≤–µ—Ä—å—é –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ –≤—Å–µ, –æ—Å–æ–±–µ–Ω–Ω–æ ‚Äî –≤–æ–∑–≥–ª–∞—Å —Å—á–∞—Å—Ç—å—è.",
            "–û, –Ω–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã. –¢–∞–Ω—Ü—É–π, –ø–æ–π–º–∞–≤, –±–æ—Å—Å–∞–Ω–æ–≤—É...",
            "...–≤ –ø–∞–ª—å—Ç–æ –Ω–∞ –≥–æ–ª–æ–µ —Ç–µ–ª–æ, –≤ —Ç—É—Ñ–ª—è—Ö –Ω–∞ –±–æ—Å—É –Ω–æ–≥—É.",
            "–ù–µ –±—É–¥—å –¥—É—Ä–∞–∫–æ–º! –ë—É–¥—å —Ç–µ–º, —á–µ–º –¥—Ä—É–≥–∏–µ –Ω–µ –±—ã–ª–∏.",
        ]

        if self.exit_attempts >= 3:
            self.state = "game_over"
            return "–¢—ã –≤—ã—à–µ–ª –∏–∑ –∫–æ–º–Ω–∞—Ç—ã. –ü–æ–∑–¥—Ä–∞–≤–ª—è—é, —Ç—ã —Å–æ–≤–µ—Ä—à–∏–ª –æ—à–∏–±–∫—É.\n–ö–û–ù–ï–¶ –ò–ì–†–´.\n\n–í–≤–µ–¥–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É."

        return random.choice(responses)

    def use_object(self, object_name: str) -> str:
        """–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ –∫–æ–º–Ω–∞—Ç–µ"""
        if object_name not in self.objects:
            return "–¢–∞–∫–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ –Ω–µ—Ç –≤ –∫–æ–º–Ω–∞—Ç–µ."

        object_data = self.objects[object_name]

        if object_name == "—à–∏–ø–∫–∞":
            # –ö—É—Ä–µ–Ω–∏–µ –®–∏–ø–∫–∏ –∑–∞–Ω–∏–º–∞–µ—Ç 3 —á–∞—Å–∞
            self.time_passed += 3

            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏
            if self.time_passed >= self.win_time:
                self.state = "game_over"
                return f"–¢—ã –∫—É—Ä–∏—à—å –®–∏–ø–∫—É...\n\n{self.get_special_ending()}"

            if object_data["uses"] <= 0:
                return "–°–∏–≥–∞—Ä–µ—Ç—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å. –ó–∞—á–µ–º —Ç–µ–±–µ –°–æ–ª–Ω—Ü–µ, –µ—Å–ª–∏ —Ç—ã –±–æ–ª—å—à–µ –Ω–µ –∫—É—Ä–∏—à—å –®–∏–ø–∫—É?"

            object_data["uses"] -= 1
            return "–¢—ã –∫—É—Ä–∏—à—å –®–∏–ø–∫—É. –ó–∞—á–µ–º —Ç–µ–±–µ –°–æ–ª–Ω—Ü–µ, –µ—Å–ª–∏ —Ç—ã –∫—É—Ä–∏—à—å –®–∏–ø–∫—É?"

        elif object_name == "–º–µ–±–µ–ª—å":
            # –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –º–µ–±–µ–ª—å—é –∑–∞–Ω–∏–º–∞–µ—Ç 2 —á–∞—Å–∞
            self.time_passed += 2

            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏
            if self.time_passed >= self.win_time:
                self.state = "game_over"
                return f"–¢—ã –∏–∑—É—á–∞–µ—à—å –º–µ–±–µ–ª—å...\n\n{self.get_special_ending()}"

            return "–ú–µ–±–µ–ª—å —Ç–æ—á—å-–≤-—Ç–æ—á—å –∫–∞–∫ –ª—é–¥–∏, –∏ –≤–æ–æ–±—â–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å."

        elif object_name == "–ø–∞–ª—å—Ç–æ":
            # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–ª—å—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç 5 —á–∞—Å–æ–≤
            self.time_passed += 5

            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏
            if self.time_passed >= self.win_time:
                self.state = "game_over"
                return f"–¢—ã –Ω–∞–¥–µ–≤–∞–µ—à—å –ø–∞–ª—å—Ç–æ...\n\n{self.get_special_ending()}"

            return "–¢–∞–Ω—Ü—É–π, –ø–æ–π–º–∞–≤, –±–æ—Å—Å–∞–Ω–æ–≤—É –≤ –ø–∞–ª—å—Ç–æ –Ω–∞ –≥–æ–ª–æ–µ —Ç–µ–ª–æ, –≤ —Ç—É—Ñ–ª—è—Ö –Ω–∞ –±–æ—Å—É –Ω–æ–≥—É."

        elif object_name == "–±—É–º–∞–≥–∞":
            if object_data["uses"] <= 0:
                return "–ë—É–º–∞–≥–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å. –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –∑–Ω–∞–∫ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –∫ –∫–æ–Ω—Ü—É."

            self.state = "writing"
            return "–¢—ã –±–µ—Ä–µ—à—å –ª–∏—Å—Ç –±—É–º–∞–≥–∏. –ù–∞–ø–∏—à–∏ —Å–≤–æ—é –º—ã—Å–ª—å –≤ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏..."

        return "–¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç, –Ω–æ –Ω–∏—á–µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç."

    def reflect(self) -> str:
        """–†–∞–∑–º—ã—à–ª—è—Ç—å –æ –∂–∏–∑–Ω–∏"""
        # –†–∞–∑–º—ã—à–ª–µ–Ω–∏—è –∑–∞–Ω–∏–º–∞—é—Ç 6 —á–∞—Å–æ–≤
        self.time_passed += 6

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏
        if self.time_passed >= self.win_time:
            self.state = "game_over"
            return f"–¢—ã —Ä–∞–∑–º—ã—à–ª—è–µ—à—å –æ –∂–∏–∑–Ω–∏...\n\n{self.get_special_ending()}"

        reflections = [
            "–ß—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–π –Ω–∞ —Å–≤–µ—Ç–µ —Å—Ç–µ–Ω—ã –∏ —Å—Ç—É–ª–∞?",
            "–ù–µ –±—É–¥—å –¥—É—Ä–∞–∫–æ–º! –ë—É–¥—å —Ç–µ–º, —á–µ–º –¥—Ä—É–≥–∏–µ –Ω–µ –±—ã–ª–∏.",
            "–ó–∞—á–µ–º –≤—ã—Ö–æ–¥–∏—Ç—å –æ—Ç—Ç—É–¥–∞, –∫—É–¥–∞ –≤–µ—Ä–Ω–µ—à—å—Å—è –≤–µ—á–µ—Ä–æ–º —Ç–∞–∫–∏–º –∂–µ, –∫–∞–∫–∏–º —Ç—ã –±—ã–ª, —Ç–µ–º –±–æ–ª–µ–µ ‚Äî –∏–∑—É–≤–µ—á–µ–Ω–Ω—ã–º?"
            "–ù–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã; –æ, –ø—É—Å–∫–∞–π —Ç–æ–ª—å–∫–æ –∫–æ–º–Ω–∞—Ç–∞ –¥–æ–≥–∞–¥—ã–≤–∞–µ—Ç—Å—è, –∫–∞–∫ —Ç—ã –≤—ã–≥–ª—è–¥–∏—à—å.",
            "–ï—Å–ª–∏ –≤–æ–π–¥–µ—Ç –∂–∏–≤–∞—è –º–∏–ª–∫–∞, –ø–∞—Å—Ç—å —Ä–∞–∑–µ–≤–∞—è, –≤—ã–≥–æ–Ω–∏ –Ω–µ —Ä–∞–∑–¥–µ–≤–∞—è.",
            "–ó–∞—á–µ–º –≤—ã—Ö–æ–¥–∏—Ç—å –∏–∑ –∫–æ–º–Ω–∞—Ç—ã? –ù–∞ —É–ª–∏—Ü–µ, —á–∞–π, –Ω–µ –§—Ä–∞–Ω—Ü–∏—è.",
        ]

        return random.choice(reflections)

    def view_thoughts(self) -> str:
        """–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –º—ã—Å–ª–∏"""
        # –ü—Ä–æ—Å–º–æ—Ç—Ä –º—ã—Å–ª–µ–π –∑–∞–Ω–∏–º–∞–µ—Ç 1 —á–∞—Å
        self.time_passed += 1

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–±–µ–¥—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏
        if self.time_passed >= self.win_time:
            self.state = "game_over"
            return f"–¢—ã –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—à—å —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏...\n\n{self.get_special_ending()}"

        if not self.thoughts:
            return "–¢—ã –µ—â–µ –Ω–µ –∑–∞–ø–∏—Å–∞–ª –Ω–∏ –æ–¥–Ω–æ–π –º—ã—Å–ª–∏."

        result = "–¢–≤–æ–∏ –º—ã—Å–ª–∏:"
        for i, thought in enumerate(self.thoughts):
            result += f"\n{i+1}. {thought}"

        return result

    def check_special_ending(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ü–æ–≤–∫–∏"""
        if self.time_passed >= self.win_time:
            self.state = "game_over"
            return True
        return False

    def check_time_ending(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –¥–ª—è –∫–æ–Ω—Ü–æ–≤–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏"""
        return False  # –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ check_special_ending –¥–ª—è –ø–æ–±–µ–¥—ã

    def get_special_ending(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –æ—Å–æ–±–æ–π –∫–æ–Ω—Ü–æ–≤–∫–∏"""
        return """
‚ïî=================‚ïó
‚ïë  –û–°–û–ë–ê–Ø –ö–û–ù–¶–û–í–ö–ê   ‚ïë
‚ïö=================‚ïù

–¢—ã –ø—Ä–æ–≤–µ–ª –≤ –∫–æ–º–Ω–∞—Ç–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –µ—ë —Å—É—Ç—å.
–ù–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã. –ó–∞–ø—Ä–∏—Å—å –∏ –∑–∞–±–∞—Ä—Ä–∏–∫–∞–¥–∏—Ä—É–π—Å—è
—à–∫–∞—Ñ–æ–º –æ—Ç —Ö—Ä–æ–Ω–æ—Å–∞, –∫–æ—Å–º–æ—Å–∞, —ç—Ä–æ—Å–∞, —Ä–∞—Å—ã, –≤–∏—Ä—É—Å–∞...

–¢—ã –ø–æ–Ω–∏–º–∞–µ—à—å, —á—Ç–æ —É–∂–µ –Ω–µ –∫–æ–º–Ω–∞—Ç–∞ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–±—è,
–∞ —Ç—ã —É–¥–µ—Ä–∂–∏–≤–∞–µ—à—å –∫–æ–º–Ω–∞—Ç—É –≤–Ω—É—Ç—Ä–∏ —Å–≤–æ–µ–≥–æ —Å–æ–∑–Ω–∞–Ω–∏—è.

–¢–æ, —á—Ç–æ —Å—á–∏—Ç–∞–ª–æ—Å—å —Ç—é—Ä—å–º–æ–π, —Å—Ç–∞–ª–æ –≤—Å–µ–ª–µ–Ω–Ω–æ–π.
–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤–Ω—É—Ç—Ä–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –±–æ–ª—å—à–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ —Å–Ω–∞—Ä—É–∂–∏.

–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!
–¢—ã –¥–æ—Å—Ç–∏–≥ –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏—è –ë—Ä–æ–¥—Å–∫–æ–≥–æ.

–í–≤–µ–¥–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É.
"""

    def get_time_ending(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –∫–æ–Ω—Ü–æ–≤–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏"""
        return """
–ñ–∏–∑–Ω—å –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –∫–æ–Ω—Ü—É. –í–µ—á–Ω–æ—Å—Ç—å –æ–±—Ä–µ—Ç–∞–µ—Ç—Å—è –ª–∏—à—å –≤ —Å–ª–æ–≤–µ.
–ö–û–ù–ï–¶ –ò–ì–†–´.

–í–≤–µ–¥–∏ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É.
"""

    def get_help(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –∏–≥—Ä–µ"""
        return """
üìú –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- –æ—Å–º–æ—Ç—Ä–µ—Ç—å—Å—è - –æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–Ω–∞—Ç—É (1 —á–∞—Å)
- —Ä–∞–∑–º—ã—à–ª—è—Ç—å - –ø—Ä–µ–¥–∞—Ç—å—Å—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è–º (6 —á–∞—Å–æ–≤)
- –≤—ã–π—Ç–∏ –¥–≤–µ—Ä—å/–æ–∫–Ω–æ/—É–±–æ—Ä–Ω–∞—è - –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –≤—ã–π—Ç–∏ (2 —á–∞—Å–∞)
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∏–ø–∫–∞/–º–µ–±–µ–ª—å/–ø–∞–ª—å—Ç–æ/–±—É–º–∞–≥–∞ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç (2-5 —á–∞—Å–æ–≤)
- –º—ã—Å–ª–∏ - –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –º—ã—Å–ª–∏ (1 —á–∞—Å)
- –ø–æ–º–æ—â—å - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥

üéÆ –¶–µ–ª—å –∏–≥—Ä—ã: –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ 200 —á–∞—Å–æ–≤, –Ω–µ –≤—ã—Ö–æ–¥—è –∏–∑ –Ω–µ—ë. 
–û—Å—Ç–æ—Ä–æ–∂–Ω–æ! –ï—Å–ª–∏ —Ç—ã –ø–æ–ø—ã—Ç–∞–µ—à—å—Å—è –≤—ã–π—Ç–∏ –±–æ–ª—å—à–µ 3 —Ä–∞–∑, —Ç–æ —Å–æ–≤–µ—Ä—à–∏—à—å –æ—à–∏–±–∫—É.
"""

    def get_intro(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∫ –∏–≥—Ä–µ"""
        return """
‚ïî=================‚ïó
‚ïë:::::::–ù–ï –í–´–•–û–î–ò ::::::::‚ïë
‚ïë::::::–ò–ó –ö–û–ú–ù–ê–¢–´:::::::‚ïë
‚ïë‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚ïë
‚ïë.....–∏–≥—Ä–∞ –ø–æ –º–æ—Ç–∏–≤–∞–º....‚ïë
‚ïë::::::—Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏—è::::::‚ïë
‚ïë::::::::::–ë—Ä–æ–¥—Å–∫–æ–≥–æ:::::::::‚ïë
‚ïë‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚ïë
‚ïë:::–∞–≤—Ç–æ—Ä @pudan416::::‚ïë
‚ïö=================‚ïù

–ù–µ –≤—ã—Ö–æ–¥–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã, –Ω–µ —Å–æ–≤–µ—Ä—à–∞–π –æ—à–∏–±–∫—É.
–ó–∞—á–µ–º —Ç–µ–±–µ –°–æ–ª–Ω—Ü–µ, –µ—Å–ª–∏ —Ç—ã –∫—É—Ä–∏—à—å –®–∏–ø–∫—É?

–¢—ã –Ω–∞—Ö–æ–¥–∏—à—å—Å—è –≤ –∫–æ–º–Ω–∞—Ç–µ. –í —Å–≤–æ–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º –º–∏—Ä–µ.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ 200 —á–∞—Å–æ–≤, –Ω–µ –≤—ã—Ö–æ–¥—è –Ω–∞—Ä—É–∂—É.
–ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è, –ø—Ä–∏–±–ª–∏–∂–∞—è —Ç–µ–±—è –∫ —Ü–µ–ª–∏.
–ù–æ –±—É–¥—å –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω - –µ—Å–ª–∏ –ø–æ–ø—ã—Ç–∞–µ—à—å—Å—è –≤—ã–π—Ç–∏ –±–æ–ª—å—à–µ 3 —Ä–∞–∑, —Ç–æ —Å–æ–≤–µ—Ä—à–∏—à—å –æ—à–∏–±–∫—É.

–í–≤–µ–¥–∏ "–ø–æ–º–æ—â—å", —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.
"""
